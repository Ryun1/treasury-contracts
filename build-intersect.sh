AIKEN=${1:-$(which aiken)}

aiken() {
  ${AIKEN} $*
}

set -e

echo "Software versions:"
echo "  Git commit       = $(git rev-parse HEAD)"
echo "  Aiken Version    = $(aiken --version)"


echo
echo "File hashes:"
SHA256=$(cat validators/treasury.ak | sha256sum | cut -f 1 -d ' ')
echo "  validators/treasury.ak              = ${SHA256}"
SHA256=$(cat validators/vendor.ak | sha256sum | cut -f 1 -d ' ')
echo "  validators/vendor.ak                = ${SHA256}"
SHA256=$(cat validators/oneshot.ak | sha256sum | cut -f 1 -d ' ')
echo "  validators/oneshot.ak               = ${SHA256}"
echo
SHA256=$(cat lib/types.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/types.ak                        = ${SHA256}"
SHA256=$(cat lib/utilities.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/utilities.ak                    = ${SHA256}"
SHA256=$(cat lib/logic/treasury/disburse.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/treasury/disburse.ak      = ${SHA256}"
SHA256=$(cat lib/logic/treasury/fund.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/treasury/fund.ak          = ${SHA256}"
SHA256=$(cat lib/logic/treasury/reorganize.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/treasury/reorganize.ak    = ${SHA256}"
SHA256=$(cat lib/logic/treasury/sweep.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/treasury/sweep.ak         = ${SHA256}"
SHA256=$(cat lib/logic/treasury/withdraw.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/treasury/withdraw.ak      = ${SHA256}"
SHA256=$(cat lib/logic/vendor/adjudicate.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/vendor/adjudicate.ak      = ${SHA256}"
SHA256=$(cat lib/logic/vendor/malformed.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/vendor/malformed.ak       = ${SHA256}"
SHA256=$(cat lib/logic/vendor/modify.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/vendor/modify.ak          = ${SHA256}"
SHA256=$(cat lib/logic/vendor/sweep.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/vendor/sweep.ak           = ${SHA256}"
SHA256=$(cat lib/logic/vendor/withdraw.ak | sha256sum | cut -f 1 -d ' ')
echo "  lib/logic/vendor/withdraw.ak        = ${SHA256}"

X=$(./codegen.sh > /dev/null 2>&1)

echo
echo "Compiling instance..."

# Note: you can get values for SEED_UTXO, TREASURY_PARAMS, and VENDOR_PARAMS
# by running aiken check and checking the traces

SEED_UTXO="D8799F582031C2DF71553C3C395FE3AE1AB0EB6E57AAC28A0F5436ED413C3C8D2139C03A6D00FF"
aiken blueprint apply -v "oneshot" $SEED_UTXO 2> /dev/null > tmp
mv tmp plutus.json
REGISTRY_POLICY_ID="$(aiken blueprint policy -v oneshot 2> /dev/null)"

TREASURY_PARAMS="D8799F581C9E65E4ED7D6FD86FC4827D2B45DA6D2C601FB920E8BFD794B8ECC619D8799FD87A9F9FD87C9F029FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFD87C9F039FD87B9F9FD8799F581CAC3DE68E8E1F9AF3E00B299E7858BC44E126B33E130D06223D799D5DFFD8799F581CC9F2966A1B357718B45A006954106BA1F7AE9FEA16E9826F3486DDD6FFFFFFD87B9F9FD8799F581C1880102B04725318EB7A6F9F481815C82473C2F50CFE9932C85A3BF8FFD8799F581C7A827787C47A4E74F102330CC8566ED9845047903121025911163B9DFFFFFFD87B9F9FD8799F581CA7F06CF4E9C03C6B7EAC317D5533D573A9BE3018FB7B9D95DD778D39FFD8799F581CD8261E2C334B58072042130182DE4FB945A46DD1B1974E1DF755FE96FFFFFFD87B9F9FD8799F581C8349F8B41D8337B617947ACE444EF95B2B80FF2605CADF969914CF95FFD8799F581CCD820BAC2773F2DF622C567AA547894177A818593BDAE996DD0881E3FFFFFFD87B9F9FD8799F581C679AD28E567EB42DDB30A5CF6B5F066B2DEFBCE393F19968D711F658FFD8799F581C36E0CF1E52E05EF92E52C7BC2A04493D6BAE481B8ACBAB12EC4300D7FFFFFFFFFFFFFFD87A9F9FD87B9F9FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFD87B9F9FD87B9F9FD8799F581C4E72B1FACDC7EEA745767B8DACA40BF73D75EB0E88DCEE80D57EEC5DFFD8799F581C1C732C072364A2AFD42A03228F3816FEC37E73F64B61F4C12BAB55EEFFFFFFD87B9F9FD8799F581C91F5B1D436080C1BECA93FBBB96596312D8F615B0AD9E94470AF2224FFD8799F581CA1EBDCC53AD3907461D92204F9789DDB640DCDCB0D9FCE786A55EAF4FFFFFFFFFFFFFFD87A9F9FD87B9F9FD87B9F9FD8799F581C4E72B1FACDC7EEA745767B8DACA40BF73D75EB0E88DCEE80D57EEC5DFFD8799F581C1C732C072364A2AFD42A03228F3816FEC37E73F64B61F4C12BAB55EEFFFFFFD87B9F9FD8799F581C91F5B1D436080C1BECA93FBBB96596312D8F615B0AD9E94470AF2224FFD8799F581CA1EBDCC53AD3907461D92204F9789DDB640DCDCB0D9FCE786A55EAF4FFFFFFFFFFD87C9F029FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFD87C9F029FD87B9F9FD8799F581CAC3DE68E8E1F9AF3E00B299E7858BC44E126B33E130D06223D799D5DFFD8799F581CC9F2966A1B357718B45A006954106BA1F7AE9FEA16E9826F3486DDD6FFFFFFD87B9F9FD8799F581C1880102B04725318EB7A6F9F481815C82473C2F50CFE9932C85A3BF8FFD8799F581C7A827787C47A4E74F102330CC8566ED9845047903121025911163B9DFFFFFFD87B9F9FD8799F581CA7F06CF4E9C03C6B7EAC317D5533D573A9BE3018FB7B9D95DD778D39FFD8799F581CD8261E2C334B58072042130182DE4FB945A46DD1B1974E1DF755FE96FFFFFFD87B9F9FD8799F581C8349F8B41D8337B617947ACE444EF95B2B80FF2605CADF969914CF95FFD8799F581CCD820BAC2773F2DF622C567AA547894177A818593BDAE996DD0881E3FFFFFFD87B9F9FD8799F581C679AD28E567EB42DDB30A5CF6B5F066B2DEFBCE393F19968D711F658FFD8799F581C36E0CF1E52E05EF92E52C7BC2A04493D6BAE481B8ACBAB12EC4300D7FFFFFFFFFFFFFFD87A9F9FD87A9F9FD87B9F9FD8799F581C4E72B1FACDC7EEA745767B8DACA40BF73D75EB0E88DCEE80D57EEC5DFFD8799F581C1C732C072364A2AFD42A03228F3816FEC37E73F64B61F4C12BAB55EEFFFFFFD87B9F9FD8799F581C91F5B1D436080C1BECA93FBBB96596312D8F615B0AD9E94470AF2224FFD8799F581CA1EBDCC53AD3907461D92204F9789DDB640DCDCB0D9FCE786A55EAF4FFFFFFFFFFD87C9F029FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFD87C9F039FD87B9F9FD8799F581CAC3DE68E8E1F9AF3E00B299E7858BC44E126B33E130D06223D799D5DFFD8799F581CC9F2966A1B357718B45A006954106BA1F7AE9FEA16E9826F3486DDD6FFFFFFD87B9F9FD8799F581C1880102B04725318EB7A6F9F481815C82473C2F50CFE9932C85A3BF8FFD8799F581C7A827787C47A4E74F102330CC8566ED9845047903121025911163B9DFFFFFFD87B9F9FD8799F581CA7F06CF4E9C03C6B7EAC317D5533D573A9BE3018FB7B9D95DD778D39FFD8799F581CD8261E2C334B58072042130182DE4FB945A46DD1B1974E1DF755FE96FFFFFFD87B9F9FD8799F581C8349F8B41D8337B617947ACE444EF95B2B80FF2605CADF969914CF95FFD8799F581CCD820BAC2773F2DF622C567AA547894177A818593BDAE996DD0881E3FFFFFFD87B9F9FD8799F581C679AD28E567EB42DDB30A5CF6B5F066B2DEFBCE393F19968D711F658FFD8799F581C36E0CF1E52E05EF92E52C7BC2A04493D6BAE481B8ACBAB12EC4300D7FFFFFFFFFFFFFFFF1B000001AE6F278C001B000001AF047FF800FF"

aiken blueprint apply -v "treasury" $TREASURY_PARAMS 2> /dev/null > tmp
mv tmp plutus.json

VENDOR_PARAMS="D8799F581C9E65E4ED7D6FD86FC4827D2B45DA6D2C601FB920E8BFD794B8ECC619D8799FD87A9F9FD87B9F9FD87B9F9FD8799F581C4E72B1FACDC7EEA745767B8DACA40BF73D75EB0E88DCEE80D57EEC5DFFD8799F581C1C732C072364A2AFD42A03228F3816FEC37E73F64B61F4C12BAB55EEFFFFFFD87B9F9FD8799F581C91F5B1D436080C1BECA93FBBB96596312D8F615B0AD9E94470AF2224FFD8799F581CA1EBDCC53AD3907461D92204F9789DDB640DCDCB0D9FCE786A55EAF4FFFFFFFFFFD87C9F029FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFFFFFD87A9F9FD87B9F9FD87B9F9FD8799F581C4E72B1FACDC7EEA745767B8DACA40BF73D75EB0E88DCEE80D57EEC5DFFD8799F581C1C732C072364A2AFD42A03228F3816FEC37E73F64B61F4C12BAB55EEFFFFFFD87B9F9FD8799F581C91F5B1D436080C1BECA93FBBB96596312D8F615B0AD9E94470AF2224FFD8799F581CA1EBDCC53AD3907461D92204F9789DDB640DCDCB0D9FCE786A55EAF4FFFFFFFFFFD87C9F029FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFFFFFD87A9F9FD87B9F9FD87B9F9FD8799F581C4E72B1FACDC7EEA745767B8DACA40BF73D75EB0E88DCEE80D57EEC5DFFD8799F581C1C732C072364A2AFD42A03228F3816FEC37E73F64B61F4C12BAB55EEFFFFFFD87B9F9FD8799F581C91F5B1D436080C1BECA93FBBB96596312D8F615B0AD9E94470AF2224FFD8799F581CA1EBDCC53AD3907461D92204F9789DDB640DCDCB0D9FCE786A55EAF4FFFFFFFFFFD87C9F029FD87B9F9FD8799F581C1BE0008BF2994524C0EAF0EFDAE4431E4A61EF7D974804FA794110B7FFD8799F581C27194940FAE07315F4DC7A0394535DEA7795DAB2F232EE40F4457E8FFFFFFFD87B9F9FD8799F581CA664DE561CCD2CA9A07C060D4DD7CEA4DC68BA89D4BF04B21FF0726FFFD8799F581C821DBB013B85872E91F59E5C3C566390C866AEA114A13B1B68F064BCFFFFFFD87B9F9FD8799F581CC236D8DC9441605238A5FE9CC7E6C1A79903289A4249C33122BF9627FFD8799F581C1B5850270F7A77EA9EF570A83FB4B120BF814EC94AA0DBA0C9C28844FFFFFFFFFFD87C9F029FD87B9F9FD8799F581CAC3DE68E8E1F9AF3E00B299E7858BC44E126B33E130D06223D799D5DFFD8799F581CC9F2966A1B357718B45A006954106BA1F7AE9FEA16E9826F3486DDD6FFFFFFD87B9F9FD8799F581C1880102B04725318EB7A6F9F481815C82473C2F50CFE9932C85A3BF8FFD8799F581C7A827787C47A4E74F102330CC8566ED9845047903121025911163B9DFFFFFFD87B9F9FD8799F581CA7F06CF4E9C03C6B7EAC317D5533D573A9BE3018FB7B9D95DD778D39FFD8799F581CD8261E2C334B58072042130182DE4FB945A46DD1B1974E1DF755FE96FFFFFFD87B9F9FD8799F581C8349F8B41D8337B617947ACE444EF95B2B80FF2605CADF969914CF95FFD8799F581CCD820BAC2773F2DF622C567AA547894177A818593BDAE996DD0881E3FFFFFFD87B9F9FD8799F581C679AD28E567EB42DDB30A5CF6B5F066B2DEFBCE393F19968D711F658FFD8799F581C36E0CF1E52E05EF92E52C7BC2A04493D6BAE481B8ACBAB12EC4300D7FFFFFFFFFFFFFFFF1B000001AFA4251C00FF"
aiken blueprint apply -v "vendor" $VENDOR_PARAMS 2> /dev/null > tmp
mv tmp plutus.json

TREASURY_SCRIPT_HASH="$(aiken blueprint policy -v treasury 2> /dev/null)"
VENDOR_SCRIPT_HASH="$(aiken blueprint policy -v vendor 2> /dev/null)"

echo
echo "Script Hashes:"
echo -e "  Registry Policy ID         = \e[32m ${REGISTRY_POLICY_ID} \e[0m"
echo -e "  Treasury Contract          = \e[32m ${TREASURY_SCRIPT_HASH} \e[0m"
echo -e "  Vendor Contract            = \e[32m ${VENDOR_SCRIPT_HASH} \e[0m"

echo
echo
